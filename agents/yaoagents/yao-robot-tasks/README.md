# Robot Tasks Agent - P2 Phase

An intelligent agent that decomposes strategic goals into executable tasks with proper executor assignments, dependencies, and validation rules for autonomous Robot execution systems.

![Robot Tasks Agent](cover.jpg)

> **Agent Type**: `robot-tasks`
>
> This agent can be selected in **Mission Control → Agent → Advanced Settings → Developer Options → Tasks** dropdown. The `type` field in `package.yao` determines which execution phase this agent is available for.

**Development Status**

| AI Planning | AI Development | AI Testing | AI Review | Manual Review | Manual Testing |
|:-----------:|:--------------:|:----------:|:---------:|:-------------:|:--------------:|
| ✅ Done | ✅ Done | ✅ Done | ✅ Done | ⏳ Pending | ⏳ Pending |

**Availability**

| Downloadable | Installable | Manual Testable |
|:------------:|:-----------:|:---------------:|
| ✅ Yes | ✅ Yes | ✅ Yes |

**Agent Type**

| Type | Selectable In |
|:----:|:-------------:|
| `robot-tasks` | Mission Control → Agent → Advanced Settings → Developer Options → Tasks |

## Quick Start

```bash
# Test with all scenarios
yao agent test -n yao.robot-tasks -i tests/inputs.jsonl -v

# Run a single test case
yao agent test -n yao.robot-tasks -i tests/inputs.jsonl --run "T001" -v

# Extract results for review
yao agent extract tests/output-*.jsonl
```

## About This Agent

This agent is the **P2 (Tasks) Phase** of the Robot execution pipeline. It receives strategic goals from P1 and decomposes them into executable tasks that can be directly run by Agents or MCP tools in P3.

### Key Features

| Feature | Description |
|---------|-------------|
| **Goal Decomposition** | Converts high-level goals into atomic, executable tasks |
| **Executor Assignment** | Maps each task to specific Agent or MCP tool |
| **Dependency Handling** | Uses `order` field to control execution sequence |
| **Validation Support** | Provides `expected_output` and `validation_rules` for P3 |
| **MCP Args Generation** | Automatically generates structured arguments for MCP tool calls |
| **Delivery Awareness** | Considers delivery target when designing final tasks |
| **Bilingual** | Supports both English and Chinese input/output |

### Two-Round Processing Architecture

This agent uses a two-round processing architecture:

```
Round 1: Main Agent
├── LLM generates tasks from Goals
├── Parse tasks via text.ExtractJSON
├── Validate task structure
└── Filter MCP tasks needing args

Round 2: Sub-Agent (parallel)
├── ctx.agent.All calls mcp-args for each MCP task
├── mcp-args generates args based on tool schema
└── Merge args back into tasks
```

For MCP tasks, the agent:
1. Gets tool schemas via `ctx.mcp.ListTools(clientID)`
2. Calls `mcp-args` sub-agent in parallel for each MCP task
3. Merges generated `args` into the final task list

### Goals vs Tasks

Understanding the difference is critical:

| Aspect | Goal (P1 Input) | Task (P2 Output) |
|--------|-----------------|------------------|
| Level | Strategic (WHAT to achieve) | Tactical (HOW to achieve) |
| Focus | Outcome & Deliverable | Executor & Instructions |
| Executable | No | Yes - directly calls Agent/MCP |
| Example | "Produce monthly sales report" | "Call data-analyst to query sales data" |

### Input Structure

The agent receives formatted input from P1 containing:

1. **Goals Section** - Strategic goals with Objective, Deliverable, Success Criteria, Resources
2. **Delivery Target** (optional) - How results should be delivered
3. **Available Resources** - Agents and MCP tools that can be used

### Output Structure

```json
{
  "tasks": [
    {
      "id": "task-001",
      "goal_ref": "Goal 1",
      "description": "Write article about AI",
      "executor_type": "agent",
      "executor_id": "yao.scribe",
      "order": 0,
      "expected_output": "Complete technical article",
      "validation_rules": ["article must be well-structured"]
    },
    {
      "id": "task-002",
      "goal_ref": "Goal 2",
      "description": "Send completion notification",
      "executor_type": "mcp",
      "executor_id": "echo.echo",
      "order": 1,
      "expected_output": "Notification sent",
      "validation_rules": ["must return success"],
      "args": { "message": "Article completed" }
    }
  ]
}
```

Note: The `args` field for MCP tasks is automatically generated by the `mcp-args` sub-agent based on the tool's input schema.

## Task Fields

| Field | Required | Description |
|-------|----------|-------------|
| `id` | Yes | Unique task ID (e.g., "task-001") |
| `goal_ref` | Yes | Reference to parent goal |
| `description` | Yes | Clear, actionable description (shown in UI) |
| `executor_type` | Yes | `agent`, `mcp`, or `process` |
| `executor_id` | Yes | Exact ID from Available Resources |
| `order` | Yes | Execution order (0-based, controls dependencies) |
| `expected_output` | Recommended | What the task should produce |
| `validation_rules` | Recommended | Specific checks for P3 |
| `args` | For MCP | Arguments for MCP tool calls (auto-generated) |

## Execution Order & Dependencies

The `order` field controls task execution sequence:

| Order | Behavior |
|-------|----------|
| 0 | Runs first, no dependencies |
| 1 | Runs after all order-0 tasks complete |
| 2 | Runs after all order-1 tasks complete |
| Same order | Tasks can run in parallel |

**Example**:
```
order 0: [Fetch data A] [Fetch data B]  ← parallel
order 1: [Analyze combined data]         ← waits for both
order 2: [Generate report]               ← waits for analysis
```

## Executor ID Formats

| Type | Format | Example |
|------|--------|---------|
| Agent | Exact ID from resources | `data-analyst` |
| MCP Tool | `clientID.toolName` | `database.query`, `email.send` |
| Process | Process name | `scripts.report.Generate` |

## Use Cases

| Scenario | Input | Key Output |
|----------|-------|------------|
| Sales Report | 3 goals from P1 | 10 tasks with dependencies |
| SEO Content | Keyword + content goals | Research → Create → Publish workflow |
| Customer Service | Ticket handling goals | Classify → Process → Report tasks |
| Lead Processing | Qualification goals | Qualify → Research → Outreach sequence |
| Financial Analysis | Report + variance goals | Data → Analysis → Report chain |

## Configuration

### Agent Type

The `type` field in `package.yao` determines which Robot execution phase this agent can be used for:

| Type | Phase | Description |
|------|-------|-------------|
| `robot-inspiration` | P0 | Discover insights and generate inspiration report |
| `robot-goals` | P1 | Convert insights into prioritized goals |
| `robot-tasks` | P2 | Decompose goals into executable tasks |
| `robot-delivery` | P4 | Format and deliver results |
| `robot-learning` | P5 | Extract insights from execution |

When you set `"type": "robot-tasks"`, this agent will appear in **Mission Control → Agent → Advanced Settings → Developer Options → Tasks** dropdown.

### Connector Options

```json
{
  "connector": "deepseek.v3",
  "connector_options": {
    "optional": true,
    "connectors": ["deepseek.v3", "openai.gpt-4o"],
    "filters": ["tool_calls"]
  }
}
```

### Model Settings

| Setting | Value | Description |
|---------|-------|-------------|
| `temperature` | 0.3 | Lower for consistent structured output |
| `max_tokens` | 4096 | Sufficient for complex task lists |
| `search` | disabled | Uses only provided resources |

## File Structure

```
assistants/yao/robot-tasks/
├── package.yao          # Agent configuration
├── prompts.yml          # System prompts
├── README.md            # This file
├── cover.jpg            # Cover image
├── src/
│   └── index.ts         # Create/Next hooks (task parsing, MCP args orchestration)
├── mcp-args/            # Sub-agent for MCP args generation
│   ├── package.yao      # Sub-agent configuration
│   ├── prompts.yml      # Args generation prompts
│   └── src/
│       └── index.ts     # Next hook (parse args from LLM)
└── tests/
    ├── inputs.jsonl     # Test cases
    └── *.md             # Extracted results
```

## Test Cases

| ID | Scenario | Key Assertions |
|----|----------|----------------|
| T001 | MCP Only (echo.ping/echo) | MCP tasks with auto-generated args |
| T002 | Mixed Agent + MCP | Agent tasks (yao.scribe) + MCP tasks with args |

## Integration

This agent is called by the Robot Executor during the P2 phase:

```go
// In robot/executor/standard/tasks.go
tasks, err := executor.RunTasks(ctx, robot, exec)
```

The output `Tasks` feeds into the P3 (Run) phase where each task is executed by its assigned executor.

## Related

- [Robot Goals Agent (P1)](../robot-goals/README.md)
- [Robot Inspiration Agent (P0)](../robot-inspiration/README.md)
- [Robot System Design](../../../docs/robot/DESIGN.md)
- [Robot Technical Reference](../../../docs/robot/TECHNICAL.md)
- [Agent Testing Guide](../../../ai-docs/testing.md)
